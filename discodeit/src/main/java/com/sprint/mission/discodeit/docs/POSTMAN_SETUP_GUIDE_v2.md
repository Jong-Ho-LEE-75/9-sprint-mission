# 📮 Postman 완벽 가이드 v2 (개선 버전)

## 🎯 주요 개선사항

### ✅ 해결된 문제

**이전 버전의 문제:**
- ❌ 사용자 삭제 후 온라인 상태 업데이트 실패
- ❌ 채널 삭제 후 메시지 테스트 실패
- ❌ 삭제 테스트로 인한 연쇄 실패

**v2의 해결책:**
- ✅ **사용자 3명 미리 생성** (user1, user2, user3)
- ✅ **채널 3개 미리 생성** (일반, 공지, 질문)
- ✅ **삭제용 리소스 분리** (user3, channel3 삭제 전용)
- ✅ **삭제 후에도 계속 테스트 가능**

---

## 🚀 빠른 시작

### 1단계: Import

#### Collection Import
1. Postman 실행
2. **Import** 버튼 클릭
3. `Discodeit_API_Collection_v2.postman_collection.json` 선택
4. **Import** 클릭

#### Environment Import
1. **Environments** 탭
2. **Import** 버튼 클릭
3. `Discodeit_Environment_v2.postman_environment.json` 선택
4. **Import** 클릭

### 2단계: Environment 선택

우측 상단에서 **"Discodeit Local v2"** 선택

### 3단계: 애플리케이션 실행

터미널에서:
```bash
cd /Users/ijongho/IdeaProjects/9-sprint-mission/discodeit
./gradlew bootRun
```

### 4단계: 초기 설정 실행 ⚠️ 중요!

**가장 먼저 실행해야 합니다:**

```
Collection > 0. 초기 설정 (먼저 실행)
```

**Collection Runner 사용 (권장):**
1. "0. 초기 설정" 폴더 우클릭
2. **Run folder** 선택
3. **Run** 버튼 클릭
4. 6개 API가 순차 실행됨:
   - 사용자 1, 2, 3 등록
   - 채널 1, 2, 3 생성

**또는 수동으로:**
1. 사용자 1 등록 → Send
2. 사용자 2 등록 → Send
3. 사용자 3 등록 → Send
4. 채널 1 생성 → Send
5. 채널 2 생성 → Send
6. 채널 3 생성 → Send

---

## 📂 Collection 구조 v2

```
디스코드잇 API v2
├── 0. 초기 설정 (먼저 실행) ⭐ 가장 중요!
│   ├── 사용자 1 등록
│   ├── 사용자 2 등록
│   ├── 사용자 3 등록
│   ├── 채널 1 생성 (일반)
│   ├── 채널 2 생성 (공지)
│   └── 채널 3 생성 (질문)
├── 1. 사용자 관리
│   ├── 전체 사용자 조회
│   ├── 사용자1 조회
│   ├── 사용자2 정보 수정
│   ├── 사용자3 삭제 (테스트용) ← 삭제해도 user1, user2 남음
│   └── 사용자1 온라인 상태 업데이트
├── 2. 권한 관리
│   ├── user1 로그인
│   └── user2 로그인
├── 3. 채널 관리
│   ├── user1의 채널 목록 조회
│   ├── 채널1 조회
│   ├── 채널2 정보 수정
│   ├── 채널3 삭제 (테스트용) ← 삭제해도 채널1, 채널2 남음
│   └── 비공개 채널 생성 (user1, user2)
├── 4. 메시지 관리
│   ├── 채널1에 메시지 전송 (user1)
│   ├── 채널1에 메시지 전송 (user2)
│   ├── 채널1의 메시지 목록 조회
│   ├── 메시지1 조회
│   ├── 메시지1 수정
│   └── 메시지2 삭제 (테스트용) ← 삭제해도 메시지1 남음
├── 5. 메시지 수신 정보
│   ├── 채널1 수신 정보 생성 (user1)
│   ├── 수신 정보 수정
│   └── user1의 수신 정보 조회
└── 6. 바이너리 파일
    ├── 파일 1개 조회
    └── 파일 여러 개 조회
```

---

## 🎯 테스트 시나리오

### 시나리오 1: 전체 플로우 (추천)

**목표**: 초기 설정부터 메시지 전송까지 전체 테스트

```
1. 초기 설정 실행 (0번 폴더)
   ↓
2. user1 로그인
   ↓
3. 채널1의 메시지 목록 조회
   ↓
4. 채널1에 메시지 전송
   ↓
5. 메시지 수정
   ↓
6. 온라인 상태 업데이트
```

### 시나리오 2: 삭제 테스트

**목표**: 삭제 후에도 다른 리소스로 계속 테스트

```
1. 초기 설정 실행
   ↓
2. 사용자3 삭제 ← user1, user2는 남아있음
   ↓
3. user1으로 로그인 ← 정상 작동 ✅
   ↓
4. 채널3 삭제 ← 채널1, 채널2는 남아있음
   ↓
5. 채널1에 메시지 전송 ← 정상 작동 ✅
```

### 시나리오 3: 여러 사용자 테스트

**목표**: 여러 사용자가 동시에 활동하는 상황

```
1. 초기 설정 실행
   ↓
2. user1 로그인
   ↓
3. user2 로그인
   ↓
4. user1이 채널1에 메시지 전송
   ↓
5. user2가 채널1에 메시지 전송
   ↓
6. 채널1의 메시지 목록 조회 ← 2개 메시지 확인
```

---

## 🔧 Environment 변수 v2

| 변수명 | 설명 | 자동 저장 |
|--------|------|----------|
| `baseUrl` | API 기본 URL | ❌ 수동 |
| `userId1` | 사용자1 ID | ✅ 자동 |
| `userId2` | 사용자2 ID | ✅ 자동 |
| `userId3` | 사용자3 ID (삭제용) | ✅ 자동 |
| `channelId1` | 채널1 ID (일반) | ✅ 자동 |
| `channelId2` | 채널2 ID (공지) | ✅ 자동 |
| `channelId3` | 채널3 ID (삭제용) | ✅ 자동 |
| `privateChannelId` | 비공개 채널 ID | ✅ 자동 |
| `messageId1` | 메시지1 ID | ✅ 자동 |
| `messageId2` | 메시지2 ID (삭제용) | ✅ 자동 |
| `readStatusId1` | 수신정보1 ID | ✅ 자동 |
| `binaryContentId` | 파일 ID | ❌ 수동 |

---

## 💡 삭제 테스트 전략

### ✅ 안전한 삭제 테스트

**삭제 전용 리소스:**
- `user3` → 삭제 후에도 user1, user2 사용 가능
- `channel3` → 삭제 후에도 채널1, 채널2 사용 가능
- `message2` → 삭제 후에도 메시지1 사용 가능

**일반 리소스 (삭제하지 않음):**
- `user1`, `user2` → 지속적으로 사용
- `channel1`, `channel2` → 지속적으로 사용
- `message1` → 지속적으로 사용

---

## 📊 Collection Runner 활용

### 전체 자동 테스트

**1. 초기 설정 자동 실행:**
```
"0. 초기 설정" 폴더 우클릭 → Run folder
```

**2. 전체 Collection 실행:**
```
Collection 우클릭 → Run collection
→ 순서 확인 → Run
```

**3. 결과 확인:**
- ✅ Passed: 성공한 테스트
- ❌ Failed: 실패한 테스트
- 상세 로그 확인 가능

---

## ⚠️ 주의사항

### 1. 초기 설정 필수

**모든 테스트 전에 "0. 초기 설정" 실행 필수!**

실행하지 않으면:
- ❌ 로그인 실패 (404 Not Found)
- ❌ 채널 조회 실패
- ❌ 모든 테스트 실패

### 2. 애플리케이션 재시작 시

**데이터 초기화됨 (메모리 DB):**

```
애플리케이션 재시작
   ↓
모든 데이터 삭제
   ↓
"0. 초기 설정" 다시 실행
```

### 3. 삭제 테스트 순서

**권장 순서:**

```
✅ 일반 테스트 먼저
   ↓
✅ 삭제 테스트 나중에
```

**비권장:**
```
❌ 삭제 테스트 먼저 → 일반 테스트 실패
```

---

## 🔄 데이터 리셋

### Collection Runner로 초기화

**전체 리셋:**
```
1. "0. 초기 설정" 폴더 Run
   → 새로운 사용자/채널 생성

2. Environment 변수 자동 업데이트
   → 새 ID로 교체됨
```

---

## 💻 Postman 변수 팁

### 동적 변수 사용

**현재 시간 자동 생성:**
```json
{
  "lastActiveAt": "{{$isoTimestamp}}"
}
```

**UUID 자동 생성:**
```json
{
  "id": "{{$guid}}"
}
```

**랜덤 이메일:**
```json
{
  "email": "user{{$randomInt}}@example.com"
}
```

---

## 🎊 v2의 장점

### ✅ 개선된 테스트 안정성

| 항목 | v1 | v2 |
|------|----|----|
| 사용자 삭제 후 | ❌ 테스트 실패 | ✅ 계속 테스트 가능 |
| 채널 삭제 후 | ❌ 테스트 실패 | ✅ 계속 테스트 가능 |
| 초기 설정 | ❌ 수동으로 하나씩 | ✅ 폴더 한 번 실행 |
| 여러 사용자 | ❌ 1명만 | ✅ 3명 동시 테스트 |
| 여러 채널 | ❌ 1개만 | ✅ 3개 동시 테스트 |

---

## 📚 추가 문서

- **API_DOCUMENTATION.md**: 전체 API 상세 문서
- **TROUBLESHOOTING.md**: 문제 해결 가이드
- **test_api_automation.py**: Python 자동화 스크립트

---

**Happy Testing with v2! 🎉**
